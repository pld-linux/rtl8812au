From ac063a4b1a87855e10f6cd1f358aaccbeee9b9c1 Mon Sep 17 00:00:00 2001
From: gordboy <35108003+gordboy@users.noreply.github.com>
Date: Mon, 18 Mar 2019 22:04:56 +0000
Subject: [PATCH] Update to kernel 5.1

---
 README.md              | 2 +-
 os_dep/osdep_service.c | 4 ++++
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/README.md b/README.md
index 74514dc..074018d 100644
--- a/README.md
+++ b/README.md
@@ -4,7 +4,7 @@
 
 Only supports 8812AU chipset.
 
-Works fine with 5.0-rc2 kernel. Source now builds with no warnings or errors.
+Works fine with 5.1-rc1 kernel. Source now builds with no warnings or errors.
 
 Greatly improved stability due to huge rewrite of phydm - "4 second glitch" seems to have been fixed, or at least vastly reduced, in driver version 5.2.20.2.
 
diff --git a/os_dep/osdep_service.c b/os_dep/osdep_service.c
index 5823d59..407fdfc 100644
--- a/os_dep/osdep_service.c
+++ b/os_dep/osdep_service.c
@@ -2072,6 +2072,10 @@ static int writeFile(struct file *fp, char *buf, int len)
 
 }
 
+#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 1, 0))
+  #define get_ds() (KERNEL_DS)
+#endif
+
 /*
 * Test if the specifi @param path is a file and readable
 * If readable, @param sz is got
